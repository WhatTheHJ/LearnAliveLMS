package com.korea.attendance.controller;

import com.korea.attendance.model.Attendance;
import com.korea.attendance.service.AttendanceService;
import org.springframework.web.bind.annotation.*;

import java.time.LocalDate;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/attendance")
public class AttendanceController {

    private final AttendanceService attendanceService;

    public AttendanceController(AttendanceService attendanceService) {
        this.attendanceService = attendanceService;
    }

    // ì¶œì„í•˜ê¸° (í•™ìƒ)
    @PostMapping("/record")
    public Map<String, String> recordAttendance(@RequestBody Attendance attendance) {
        boolean success = attendanceService.recordAttendance(attendance);
        return success ? Map.of("message", "ì¶œì„ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.") : Map.of("error", "ì´ë¯¸ ì¶œì„ì´ ê¸°ë¡ëœ ë‚ ì§œì…ë‹ˆë‹¤.");
    }

    // êµìˆ˜ìê°€ ì¶œì„ ìˆ˜ì •
    @PutMapping("/update")
    public Map<String, String> updateAttendance(@RequestBody Map<String, Object> request) {
        int attendanceId = (int) request.get("attendanceId");
        String state = (String) request.get("state");
        String reason = (String) request.get("reason");
        attendanceService.updateAttendance(attendanceId, state, reason);
        return Map.of("message", "ì¶œì„ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // íŠ¹ì • ê°•ì˜ì‹¤ì˜ íŠ¹ì • ë‚ ì§œ ì¶œì„ ì¡°íšŒ
    @GetMapping("/{classId}/{date}")
    public List<Attendance> getAttendanceByClassAndDate(
            @PathVariable("classId") int classId,
            @PathVariable("date") String date) {

        // ìš”ì²­ ê°’ í™•ì¸ ë¡œê·¸ ì¶”ê°€
        System.out.println("ğŸ“Œ ìš”ì²­ ë°›ì€ classId: " + classId + ", date: " + date);

        return attendanceService.getAttendanceByClassAndDate(classId, date);
    }


}
