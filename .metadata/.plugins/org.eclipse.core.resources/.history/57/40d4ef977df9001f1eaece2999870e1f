package com.korea.attendance.repository;

import com.korea.attendance.model.SurveyResponse;
import org.apache.ibatis.annotations.*;

import java.util.List;

@Mapper
public interface SurveyResponseMapper {

    /** ✅ 특정 사용자의 기존 응답 조회 */
    @Select("SELECT * FROM survey_response WHERE survey_id = #{surveyId} AND user_id = #{userId}")
    @Results({
        @Result(property = "surveyId", column = "survey_id"),
        @Result(property = "userId", column = "user_id"),
        @Result(property = "questionId", column = "question_id"),
        @Result(property = "response", column = "response")
    })
    List<SurveyResponse> getUserResponse(@Param("surveyId") int surveyId, @Param("studentId") String studentId);

    /** ✅ 새로운 응답 삽입 */
    @Insert("INSERT INTO survey_response (survey_id, student_id, question_id, response) VALUES (#{surveyId}, #{studentId}, #{questionId}, #{response})")
    void insertResponse(@Param("surveyId") int surveyId, @Param("studentId") String studentId,
                        @Param("questionId") int questionId, @Param("response") String response);

    /** ✅ 기존 응답 업데이트 */
    @Update("UPDATE survey_response SET response = #{response} WHERE survey_id = #{surveyId} AND student_id = #{studentId} AND question_id = #{questionId}")
    void updateResponse(@Param("surveyId") int surveyId, @Param("studentId") String studentId,
                        @Param("questionId") int questionId, @Param("response") String response);
}
