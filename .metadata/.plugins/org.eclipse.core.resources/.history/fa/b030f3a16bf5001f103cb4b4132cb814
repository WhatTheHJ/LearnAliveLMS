package com.korea.attendance.service;

import com.korea.attendance.repository.SurveyMapper;
import com.korea.attendance.model.*;
import org.springframework.stereotype.Service;
import java.util.List;

@Service
public class SurveyService {
    private final SurveyMapper surveyMapper;

    public SurveyService(SurveyMapper surveyMapper) {
        this.surveyMapper = surveyMapper;
    }

    /** âœ… íŠ¹ì • ê°•ì˜ì‹¤ì˜ ì„¤ë¬¸ì¡°ì‚¬ ê²Œì‹œíŒ ëª©ë¡ ì¡°íšŒ */
    public List<SurveyBoard> getSurveyBoardsByClassId(int classId) {
        List<SurveyBoard> boards = surveyMapper.findSurveyBoardsByClassId(classId);

        // âœ… ë§Œì•½ boardsê°€ ë¹„ì–´ìˆë‹¤ë©´ ìƒˆë¡œìš´ ê²Œì‹œíŒ ìë™ ìƒì„± í›„ ì¡°íšŒ
        if (boards.isEmpty()) {
            surveyMapper.createSurveyBoard(classId);
            boards = surveyMapper.findSurveyBoardsByClassId(classId);
        }

        return boards;
    }

    /** âœ… ì„¤ë¬¸ì¡°ì‚¬ ê²Œì‹œíŒ ìƒì„± */
    public void createSurveyBoard(int classId) {
        surveyMapper.createSurveyBoard(classId);
    }
    
    /** âœ… íŠ¹ì • ê°•ì˜ì‹¤ì˜ ì„¤ë¬¸ì¡°ì‚¬ ê²Œì‹œíŒì´ ì—†ìœ¼ë©´ ìƒì„± í›„ ë°˜í™˜ */
    public SurveyBoard getOrCreateSurveyBoard(int classId) {
        SurveyBoard board = surveyMapper.getSurveyBoardByClassId(classId);
        if (board == null) {
            surveyMapper.createSurveyBoard(classId);
            board = surveyMapper.getSurveyBoardByClassId(classId);
        }
        return board;
    }

    /** âœ… ì„¤ë¬¸ì¡°ì‚¬ ìƒì„± (ê²Œì‹œíŒì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±) */
    public void createSurveyPost(SurveyPost surveyPost) {
        // ğŸ”¥ boardIdê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì˜¤ë¥˜ ë°©ì§€
        if (surveyPost.getBoardId() == 0 || surveyPost.getBoardId() == 0) {
            throw new IllegalArgumentException("ê²Œì‹œíŒ ID(boardId)ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }
        
        surveyMapper.createSurveyPost(surveyPost);
    }
    
    /** âœ… íŠ¹ì • ê²Œì‹œíŒì˜ ì„¤ë¬¸ì¡°ì‚¬ ëª©ë¡ ì¡°íšŒ */
    public List<SurveyPost> getSurveyPostsByBoardId(int boardId) {
        return surveyMapper.getSurveyPostsByBoardId(boardId);
    }

    /** âœ… ì„¤ë¬¸ ì§ˆë¬¸ ì¶”ê°€ */
    public void createSurveyQuestion(SurveyQuestion question) {
        surveyMapper.createSurveyQuestion(question);
    }

    /** âœ… íŠ¹ì • ì„¤ë¬¸ì¡°ì‚¬ì˜ ì§ˆë¬¸ ì¡°íšŒ */
    public List<SurveyQuestion> getSurveyQuestionsBySurveyId(int surveyId) {
        return surveyMapper.getSurveyQuestionsBySurveyId(surveyId);
    }

    /** âœ… ì„¤ë¬¸ ì‘ë‹µ ì €ì¥ */
    public void saveSurveyResponse(SurveyResponse response) {
        surveyMapper.saveSurveyResponse(response);
    }

    /** âœ… íŠ¹ì • ì„¤ë¬¸ì¡°ì‚¬ì˜ ì‘ë‹µ ì¡°íšŒ */
    public List<SurveyResponse> getSurveyResponsesBySurveyId(int surveyId) {
        return surveyMapper.getSurveyResponsesBySurveyId(surveyId);
    }
}
